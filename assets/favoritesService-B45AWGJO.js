import{a as o,b as n}from"./index-SyzLrohR.js";class i{static async updateFavorites(t,e){try{console.log(`Updating favorites for user ${t.user_id}...`);const r={user_id:t.user_id,fav_carparks:e};console.log("Favorites request:",r);const a=await o.put(n.UPDATE_FAVORITES,r,{timeout:1e4,retries:2,headers:{"Content-Type":"application/json",Accept:"*/*"}});if(!a.success)return{error:this.getFavoritesErrorMessage(a.error)};if(a.data.error)return{error:this.getFavoritesErrorMessage(a.data.error)};if(console.log("Raw favorites API response:",{fullResponse:a.data,updated:a.data.updated}),!a.data.updated)return console.error("API indicated update failed:",a.data),{error:"Failed to update favorites. Please try again."};const s={...t,favoriteCarparks:e};return console.log("Favorites update successful:",{userId:s.user_id,favoriteCount:s.favoriteCarparks?.length||0,favorites:s.favoriteCarparks}),{user:s}}catch(r){return console.error("Favorites update error:",r),{error:this.getFavoritesErrorMessage(r)}}}static async addFavorite(t,e){const r=t.favoriteCarparks||[];if(r.includes(e))return{user:t};const a=[...r,e];return this.updateFavorites(t,a)}static async removeFavorite(t,e){const r=t.favoriteCarparks||[];if(!r.includes(e))return{user:t};const a=r.filter(s=>s!==e);return this.updateFavorites(t,a)}static async toggleFavorite(t,e){return(t.favoriteCarparks||[]).includes(e)?{...await this.removeFavorite(t,e),action:"removed"}:{...await this.addFavorite(t,e),action:"added"}}static async clearAllFavorites(t){return this.updateFavorites(t,[])}static async reorderFavorites(t,e){const r=t.favoriteCarparks||[];return e.every(s=>r.includes(s))&&e.length===r.length?this.updateFavorites(t,e):{error:"Invalid reorder: favorites list mismatch"}}static getFavoritesStats(t){const e=t.favoriteCarparks||[],r=t.subscription==="premium"?50:10;return{count:e.length,maxAllowed:r,canAddMore:e.length<r,isEmpty:e.length===0}}static canAddFavorite(t){return this.getFavoritesStats(t).canAddMore}static getFavoritesLimitMessage(t){const e=this.getFavoritesStats(t);return e.canAddMore?null:t.subscription==="free"?`You've reached the limit of ${e.maxAllowed} favorite carparks. Upgrade to Premium for more favorites.`:`You've reached the maximum of ${e.maxAllowed} favorite carparks.`}static isValidCarparkId(t){return typeof t=="string"&&t.length>0&&t.length<=10&&/^[A-Z0-9]+$/.test(t)}static getFavoritesErrorMessage(t){if(typeof t=="string"){if(t.includes("limit")||t.includes("maximum"))return"You have reached the maximum number of favorite carparks.";if(t.includes("network")||t.includes("timeout"))return"Network error. Please check your connection and try again.";if(t.includes("invalid")||t.includes("not found"))return"Invalid carpark. Please try again."}return"Failed to update favorites. Please try again."}static createFavoritesBackup(t){return[...t.favoriteCarparks||[]]}static async restoreFavoritesFromBackup(t,e){return this.updateFavorites(t,e)}}i.updateFavorites.bind(i);i.addFavorite.bind(i);i.removeFavorite.bind(i);i.toggleFavorite.bind(i);export{i as FavoritesService};
